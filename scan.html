<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>è¯·æ‰«ææ¡å½¢ç </title>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <link rel="stylesheet" href="static/style.css">
</head>

<body class="page page-scan">
    <div class="card scan-card">
        <div class="emoji">ğŸ“·</div>
        <h2>è¯·æ‰«ææ¡å½¢ç </h2>
        <p class="subtitle">å‘å³æ»‘åŠ¨æ‰«æçº¿å®Œæˆæ‰«æ</p>

        <div class="barcode-box">
            <div class="barcode"></div>

            <!-- æ»‘åŠ¨æ¡ -->
            <div class="scan-track" id="track">
                <div class="scan-thumb" id="thumb"></div>
            </div>
        </div>

        <p class="hint">æç¤ºï¼šæŒ‰ä½ç»¿è‰²åœ†ç‚¹å‘å³æ»‘åŠ¨ï¼Œå°±åƒæ‰«æ¡å½¢ç ä¸€æ ·</p>
    </div>

    <script>
        const track = document.getElementById('track');
        const thumb = document.getElementById('thumb');

        let dragging = false;
        let startX = 0;
        let startLeft = 0;

        function px(v) { return Number(String(v).replace('px', '')); }
        function getMaxLeft() {
            return track.clientWidth - thumb.clientWidth;
        }

        function handleStart(clientX) {
            dragging = true;
            startX = clientX;
            startLeft = px(getComputedStyle(thumb).left);
        }

        function handleMove(clientX) {
            if (!dragging) return;
            let dx = clientX - startX;
            let newLeft = Math.min(Math.max(0, startLeft + dx), getMaxLeft());
            thumb.style.left = newLeft + 'px';

            // æ»‘åˆ° 90% ä»¥åï¼Œç®—å®Œæˆï¼Œè·³åˆ°å¡ç‰‡é¡µ
            if (newLeft >= getMaxLeft() * 0.9) {
                dragging = false;
                setTimeout(() => { location.href = 'cards.html'; }, 300);
            }
        }

        function handleEnd() {
            if (!dragging) return;
            // æ²¡æ»‘åˆ°ç»ˆç‚¹å°±æ¾æ‰‹ï¼Œå›åˆ°æœ€å·¦è¾¹
            if (px(thumb.style.left || 0) < getMaxLeft() * 0.9) {
                thumb.style.left = '0px';
            }
            dragging = false;
        }

        // PC é¼ æ ‡
        thumb.addEventListener('mousedown', e => {
            e.preventDefault();
            handleStart(e.clientX);
        });
        window.addEventListener('mousemove', e => handleMove(e.clientX));
        window.addEventListener('mouseup', handleEnd);

        // æ‰‹æœºè§¦æ‘¸
        thumb.addEventListener('touchstart', e => {
            const t = e.touches[0];
            handleStart(t.clientX);
        });
        window.addEventListener('touchmove', e => {
            const t = e.touches[0];
            handleMove(t.clientX);
        }, { passive: false });
        window.addEventListener('touchend', handleEnd);
    </script>
</body>

</html>